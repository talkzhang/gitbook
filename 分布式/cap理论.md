## cap理论

原文链接：https://zhuanlan.zhihu.com/p/33999708

- C consistency 一致性
- A availability 可用性
- P Partition tolerance 分区容错性

只要在分布式系统中，P肯定是会存在的，那么这三者的组合通常是CP、AP，所以面临的问题就是在一致性和可用性之间的取舍问题。

为什么会出现这种组合？一般来说，分布式系统是分布在多个位置的。比如我们的一台服务器在北京，一台在上海。可能由于天气等原因的影响。造成了两条服务器直接不能互相通信，数据不能进行同步。这就是分区容错。我们认为，分区容错是不可避免的。也就是说 P 是必然存在的。

例如，A、B节点，正常情况下，A节点数据发生改变，B节点可以收到通知同步对数据进行更新，但是由于网络原因，A发生改变后，链接B的过程中发生了网络异常，或者说B临时宕机挂掉了，这种情况下怎么办，如果要保证CP（一致性）则阻塞等待，直到与B取得联系，或者直接舍弃该请求，这样的话损失了可用性；如果保证AP（可用性），则链接不上也不阻塞，也不放弃请求，直接返回，当然可以通过某些复杂的技术手段实现最终结果一致性，但是这在一定程度上失了一致性。

拿zookeeper和eureka举例来说，都是用来作为中间件注册节点的，zookeeper注重的CP，即强一致性，再集群部署（保证高可用）时，节点异常后容易在客户端发送请求后发生阻塞；而eureka发生异常后直接丢弃不影响后续请求。可参考：https://www.cnblogs.com/jichi/p/12797557.html

系统在不同的场景做出不同的决策才是最重要的。

## zk原理

https://segmentfault.com/a/1190000022861935